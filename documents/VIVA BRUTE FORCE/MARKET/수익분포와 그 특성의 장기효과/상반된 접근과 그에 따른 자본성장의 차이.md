## 상반된 접근과 그에 따른 자본성장의 차이



### 데이터 전처리 



 약 4.5년 동안의 USD KRW 데이터로 계산을 해보았다.

```python
import numpy as np
import matplotlib.pyplot as plt
import csv
import os


# rawX에서 targetValue의 인덱스 찾기
def findIndexAtValue(rawX, targetValue):
    for i in range(len(rawX)):
        if rawX[i] == targetValue:
            return i


# rawX의 문자열을 실수로. 비정형 문자열에 대한 예외처리 필요.
def strToFloat(rawX):
    floatX = []
    for i in range(len(rawX)):
        if rawX[i] != '.':
            floatX.append(float(rawX[i]))
        elif rawX[i] == '.':
            # 예외처리 문자열의 경우 0이 아니라 이전 인덱스의 값으로 대체.
            if i > 0:
                if rawX[i - 1] == '.':
                    floatX.append(float(rawX[i - 2]))
                else:
                    floatX.append(float(rawX[i - 1]))
            else:
                floatX.append(0)

    return floatX


# csv 파일 읽기
raw_date = []
raw_usd = []
raw_total = []

script_dir = os.path.dirname(__file__)
rel_path = "dataStorage/USDKRW0507.csv"
abs_file_path = os.path.join(script_dir, rel_path)

f = open(abs_file_path, 'r', encoding='utf-8')
rdr = csv.reader(f)
for line in rdr:
    raw_date.append(line[0])
    raw_usd.append(line[1])
f.close()

if raw_date[0] == 'DATE':
    del raw_date[0]
if raw_usd[0] == 'DEXKOUS':
    del raw_usd[0]

# raw_total
raw_total.append(raw_date)
raw_total.append(raw_usd)

# raw_usd의 문자열을 실수로. '.' 예외처리 필요.
raw_usd = strToFloat(raw_usd)

print(findIndexAtValue(raw_date, '2015-01-01'))  # 438
print(findIndexAtValue(raw_date, '2015-12-31'))  # 698
print(findIndexAtValue(raw_date, '2018-04-27'))  # 1304

# YoY   from 2014-05-01 to 2018-04-27
yoyList = []
start = findIndexAtValue(raw_date, '2014-05-01')
end = findIndexAtValue(raw_date, '2018-04-27')

for i in range(len(raw_date)):

    if i < start:
        yoyList.append(0)
    else:
        before = i - 365
        temp = (raw_usd[i] - raw_usd[before]) / raw_usd[i]
        yoyList.append(temp)

# MoM   from 2013-06-03 to 2018-04-27
momList = []
start = findIndexAtValue(raw_date, '2013-06-03')
end = findIndexAtValue(raw_date, '2018-04-27')

for i in range(len(raw_date)):
    if i < start:
        momList.append(0)
    else:
        before = i - 30
        temp = (raw_usd[i] - raw_usd[before]) / raw_usd[i]
        momList.append(temp)

plt.plot(momList, label='momList')
plt.legend()
plt.show()
```



약 30거래일의 주기를 가지고 그린 시장의 수익률 분포도이다.



<img src="https://raw.githubusercontent.com/ysjhmtb/blog_images/master/documents/VIVA%20BRUTE%20FORCE/MARKET/%EC%88%98%EC%9D%B5%EB%B6%84%ED%8F%AC%EC%99%80%20%EA%B7%B8%20%ED%8A%B9%EC%84%B1%EC%9D%98%20%EC%9E%A5%EA%B8%B0%ED%9A%A8%EA%B3%BC/momList.png">









### 시장의 단기 움직임과 장기효과 



```python
# momYield and Kelly : 1
momYield = []

j = 0

while j < len(momList) - 10:

    if momList[j] > 0.02:
        buyPrice = raw_usd[j]
        duration = j + 5
        sellPrice = raw_usd[duration]
        result = (sellPrice - buyPrice) / buyPrice
        momYield.append(result)
        j += 5
        continue

    elif momList[j] < -0.02:
        sellPrice = raw_usd[j]
        duration = j + 5
        buyPrice = raw_usd[duration]
        result = (sellPrice - buyPrice) / sellPrice
        momYield.append(result)
        j += 5
        continue

    j += 1

f = 0
fList = []
maxList = []
while f < 10:
    elog1fx = 0
    for k in range(len(momYield)):
        elog1fx += ((1 / len(momYield)) * np.log2(1 + f * momYield[k]))
    fList.append(f)
    maxList.append(elog1fx)

    f += 0.01

plt.plot(fList, maxList, label='f1')
plt.legend()
plt.show()


plt.plot(momYield, label='momYield1')
plt.legend()
plt.show()

```



 시장이 일시적으로 쏠림현상이 나타났을 때, 포지션을 잠시 보유 후 매각하는 경우의 수익률 양상과 최적베팅비율 계산을 해보았다. 그림에서 확인할 수 있는 것처럼 약 7배의 레버리지가 권장되었다.



<img src="https://github.com/ysjhmtb/blog_images/blob/master/documents/VIVA%20BRUTE%20FORCE/MARKET/%EC%88%98%EC%9D%B5%EB%B6%84%ED%8F%AC%EC%99%80%20%EA%B7%B8%20%ED%8A%B9%EC%84%B1%EC%9D%98%20%EC%9E%A5%EA%B8%B0%ED%9A%A8%EA%B3%BC/f1.png?raw=true">







### 그에 따른 자본성장



 ```python
# compound interest
seed = 100
seedlist = []
for i in range(len(momYield)):
    seed *= (1 + 7 * momYield[i])
    seedlist.append(seed)

plt.plot(seedlist,label='compound interest growth')
plt.legend()
plt.show()

plt.plot(momYield,label='yield distribution')
plt.legend()
plt.show()
 ```

 

 계산된 레버리지를 사용했다고 가정했을 때의 자본성장은 다음과 같았다. 최대 2.7배에 이르는 자본성장을 보였고, 예상했던 것처럼 성장의 변동성은 컸다.(레버리지에 따른 필연적 결과이다.)



<img src="https://github.com/ysjhmtb/blog_images/blob/master/documents/VIVA%20BRUTE%20FORCE/MARKET/%EC%88%98%EC%9D%B5%EB%B6%84%ED%8F%AC%EC%99%80%20%EA%B7%B8%20%ED%8A%B9%EC%84%B1%EC%9D%98%20%EC%9E%A5%EA%B8%B0%ED%9A%A8%EA%B3%BC/cig.png?raw=true">

<img src="https://github.com/ysjhmtb/blog_images/blob/master/documents/VIVA%20BRUTE%20FORCE/MARKET/%EC%88%98%EC%9D%B5%EB%B6%84%ED%8F%AC%EC%99%80%20%EA%B7%B8%20%ED%8A%B9%EC%84%B1%EC%9D%98%20%EC%9E%A5%EA%B8%B0%ED%9A%A8%EA%B3%BC/yd.png?raw=true">





### 이전과 다른 거래 시나리오



```python
# momYield and Kelly : 2
momYield = []

j = 0

while j < len(momList) - 30:

    if momList[j] > 0.03:
        sellPrice = raw_usd[j]
        duration = j + 30
        buyPrice = raw_usd[duration]
        result = (sellPrice - buyPrice) / sellPrice
        momYield.append(result)
        j += 30
        continue


    elif momList[j] < -0.03:
        buyPrice = raw_usd[j]
        duration = j + 30
        sellPrice = raw_usd[duration]
        result = (sellPrice - buyPrice) / buyPrice
        momYield.append(result)
        j += 30
        continue

    j += 1

f = 0
fList = []
maxList = []
while f < 10:
    elog1fx = 0
    for k in range(len(momYield)):
        elog1fx += ((1 / len(momYield)) * np.log2(1 + f * momYield[k]))
    fList.append(f)
    maxList.append(elog1fx)

    f += 0.01

plt.plot(fList, maxList, label='f2')
plt.legend()
plt.show()

plt.plot(momYield, label='momYield2')
plt.legend()
plt.show()
```

 이번에는 앞서와 달리 시장의 쏠림과 반대방향으로 좀더 오래 포지션을 보유한 경우를 계산을 해보았고, 그에 따라 어느 정도의 레버리지가 필요한지 계산하였는데, 레버리지 사용을 지양해야 한다는 결과가 나왔다. 





<img src="https://github.com/ysjhmtb/blog_images/blob/master/documents/VIVA%20BRUTE%20FORCE/MARKET/%EC%88%98%EC%9D%B5%EB%B6%84%ED%8F%AC%EC%99%80%20%EA%B7%B8%20%ED%8A%B9%EC%84%B1%EC%9D%98%20%EC%9E%A5%EA%B8%B0%ED%9A%A8%EA%B3%BC/momYield2.png?raw=true">



<img src="https://github.com/ysjhmtb/blog_images/blob/master/documents/VIVA%20BRUTE%20FORCE/MARKET/%EC%88%98%EC%9D%B5%EB%B6%84%ED%8F%AC%EC%99%80%20%EA%B7%B8%20%ED%8A%B9%EC%84%B1%EC%9D%98%20%EC%9E%A5%EA%B8%B0%ED%9A%A8%EA%B3%BC/f2.png?raw=true">



###시사점

 지금 계산한 데이터는 수년간의 USD KRW 시장이지만 과거의 관찰로 추정하건대 다른 시장도 그 본질적 특성은 공유할 것이라 생각된다. 시장은 정규분포하는가? 아닌 것 같다. 오히려 잦은 쏠림 현상을 만나게 되고, 분포는 뭉쳐서 존재하는 것 같다. 이런 특성으로 인해 변칙적인 현상을 자주 만나게 되지만, 동시에 그 속에 기회가 존재할 것이다.



> 시장은 우리가 감당할 수 없을 만큼 오랫동안 비합리적으로 움직일 수 있다. - 존 메이너드 케인스

