# 19.7 완벽한 전달과 std::forward





```c++

// main.cpp

#include <iostream>
#include <vector>
#include <utility>  // std::forward

struct MyStruct {

};

void func(MyStruct &s) {
    std::cout << "Pass by L-ref" << std::endl;
}

void func(MyStruct &&s) {
    std::cout << "Pass by R-ref" << std::endl;
}


template<typename T>
void func_wrapper(T &&t) {
    func(std::forward<T>(t));   // L인지 R인지를 구분해서 전달.
}

int main() {

    MyStruct s;

    func(s);
    func(MyStruct());

    func_wrapper(s);
    func_wrapper(MyStruct());


    return 0;
}



```

<br>

```C++

// main.cpp

#include <iostream>
#include <vector>
#include <cstdio>
#include <utility>  // std::forward


class CustomVector {
public:
    unsigned n_data = 0;
    int *ptr = nullptr;

    CustomVector(const unsigned &_n_data, const int &_init = 0) {
        std::cout << "Constructor" << std::endl;
        init(_n_data, _init);
    }

    CustomVector(CustomVector &l_input) {
        std::cout << "Copy constructor" << std::endl;
        init(l_input.n_data);

        for (unsigned i = 0; i < n_data; ++i)
            ptr[i] = l_input.ptr[i];
    }

    CustomVector(CustomVector &&r_input) {
        std::cout << "Move constructor" << std::endl;

        n_data = r_input.n_data;
        ptr = r_input.ptr;

        r_input.n_data = 0;
        r_input.ptr = nullptr;

    }

    ~CustomVector() {
        delete[] ptr;
    }

    void init(const unsigned &_n_data, const int &_init = 0) {
        n_data = _n_data;
        ptr = new int[n_data];
        for (unsigned i = 0; i < n_data; ++i)
            ptr[i] = _init;
    }
};


void doSomething(CustomVector &vec) {
    std::cout << "Pass by L-reference" << std::endl;
    CustomVector new_vec(vec);
}

void doSomething(CustomVector &&vec) {
    std::cout << "Pass by R-reference" << std::endl;
    CustomVector new_vec(std::move(vec));   // Note: vec itself is L-value. vec도 변수, 즉 L. 
}

template<typename T>
void doSomethingTemplate(T &&vec) {
    doSomething(std::forward<T>(vec));
}


int main() {

    {
        CustomVector my_vec(10, 1024);
        CustomVector temp(std::move(my_vec));

        std::cout << my_vec.n_data << std::endl;

        std::cout << std::endl;
    }

    {
        CustomVector my_vec(10, 1024);

        doSomething(my_vec);
        doSomething(CustomVector(10, 8));

        std::cout << std::endl;

        doSomethingTemplate(my_vec);
        doSomethingTemplate(CustomVector(10, 8));


    }


    return 0;
}



```

<br>