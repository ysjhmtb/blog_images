# 19.5 작업 기반 비동기 프로그래밍





```C++

// main.cpp


#include <iostream>
#include <future>
#include <thread>


int main() {


    {
        // multi-threading
        {
            int result;
            std::thread t([&]() -> void { result = 1 + 2; });
            t.join();
            std::cout << result << std::endl;
        }

        // task-based parallelism
        {
            // std::future<int> fut = ...

            // auto fut = std::async([]() -> int { return 1 + 2; });
            auto fut = std::async([] { return 1 + 2; });
            std::cout << fut.get() << std::endl;
        }

        // future and promise
        {
            std::promise<int> prom;
            auto fut = prom.get_future();

            auto t = std::thread([](std::promise<int> &&prom) {
                prom.set_value(1 + 2);
            }, std::move(prom));

            std::cout << fut.get() << std::endl;
            t.join();
        }


        {
            auto f1 = std::async([] {
                std::cout << "async1 start" << std::endl;
                std::this_thread::sleep_for(std::chrono::seconds(2));
                std::cout << "async1 end" << std::endl;
            });

            auto f2 = std::async([] {
                std::cout << "async2 start" << std::endl;
                std::this_thread::sleep_for(std::chrono::seconds(1));
                std::cout << "async2 end" << std::endl;
            });

            std::cout << "main function" << std::endl;


        }
    }


    return 0;
}



```

